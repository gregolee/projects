<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
const cities = [];

/*
 *  Fetch APIë¥¼ ì´ìš©í•˜ë©´ Requestë‚˜ Responseì™€ ê°™ì€ HTTPì˜ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ìš”ì†Œë¥¼ ì¡°ì‘í•˜ëŠ”ê²ƒì´ ê°€ëŠ¥
 *  fetch() ë©”ì„œë“œë¥¼ ì´ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ë¹„ë™ê¸° ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ì•Œê¸°ì‰½ê²Œ ê¸°ìˆ í•  ìˆ˜ ìˆìŒ
 *  - ìƒì„¸ ë‚´ìš©ì€ ë‹¤ìŒì„ ì°¸ì¡° : https://developer.mozilla.org/ko/docs/Web/API/Fetch_API/Fetch%EC%9D%98_%EC%82%AC%EC%9A%A9%EB%B2%95
 */
const prom = fetch(endpoint);
console.log(prom);  //ì´ê²ƒì€ ë°ì´í„°ë¥¼ ë¦¬í„´ì‹œí‚¤ì§€ ì•Šê³ , promiseë¥¼ ë°˜í™˜í•œë‹¤.

/*
 *  ì•„ë˜ ì½”ë“œê°€ ë¦¬í„´í•´ì£¼ëŠ” ê²ƒì€ Responseì´ë‹¤. 
 *  ì´ ê°ì²´ ë‚´ prototypeì„ ì°¾ë‹¤ë³´ë©´ blobì˜ ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ìˆìœ¼ë‚˜ blobì´ ìš°ë¦¬ê°€ ì›í•˜ëŠ” í˜•íƒœì˜ ë°ì´í„°ë¡œ í™œìš©í•  ìˆ˜ ì—†ë‹¤.
 *  ë”°ë¼ì„œ blobì„ prototypeì— ì¡´ì¬í•˜ëŠ” json()ì„ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¡œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ë³€ê²½í•´ì¤€ë‹¤.
 *  (ìƒì„¸ ì‚¬ìš©ë°©ë²•ì€ Fetch APIì—ì„œ ìì„¸íˆ ì„¤ëª…í•˜ê³  ìˆìœ¼ë‹ˆ ì°¸ì¡°í•˜ê¸¸ ë°”ëŒ)
 */
fetch(endpoint)
  .then(blob => console.log(blob));

/*
 *  ì•„ë˜ ì½”ë“œëŠ” ìˆ˜ë§ì€ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤€ë‹¤.
 */
fetch(endpoint)
  .then(blob => blob.json())        
  .then(data => console.log(data));

/*
 *  cities.push(data) : cities[?] ì¸ ì¸ë±ìŠ¤ì— 1000ê°œì˜ ë°°ì—´ë°ì´í„°ë¥¼ ì§‘ì–´ ë„£ëŠ”ë‹¤.
 *  cities.push(...data) : [ES6] citiesì˜ n ~ n+999 ë§ˆë‹¤ ë°ì´í„°ë¥¼ pushí•œë‹¤.
 */
fetch(endpoint)
  .then(blob => blob.json())        
  .then(data => cities.push(...data));

function findMatches(wordToMatch, cities) {
  return cities.filter(place => {
    // ë„ì‹œì™€ ì£¼ì˜ ëª…ì¹­ì´ ì°¾ê³ ìí•˜ëŠ” ë¬¸ìì™€ ë§¤ì¹­ì´ ë˜ëŠ” ê²½ìš°
    const regex = new RegExp(wordToMatch, 'gi');
    return place.city.match(regex) || place.state.match(regex);
  });
}

function numberWithCommas(x) {
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function displayMatches() {
  const matchArray = findMatches(this.value, cities);
  const html = matchArray.map(place => {
    const regex = new RegExp(this.value, 'gi');
    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
    const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
    return `
      <li>
        <span class="name">${cityName}, ${stateName}</span>
        <span class="population">${numberWithCommas(place.population)}</span>
      </li>
    `;
  }).join("");
  suggestions.innerHTML = html;
}

const searchInput = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');

//searchInput.addEventListener('change', displayMatches); //'change'ëŠ” í•´ë‹¹ inputì—ì„œ ë²—ì–´ë‚œ ê²½ìš°ë¥¼ ê°ì§€í•œë‹¤. 'keyup'ìœ¼ë¡œ í•˜ë©´ í‚¤ë³´ë“œë¡œ ì…ë ¥ í›„ ê°ì§€í•œë‹¤.
searchInput.addEventListener('keyup', displayMatches);

</script>
</body>
</html>